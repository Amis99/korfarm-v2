# 국어농장 홈페이지 프로그램 기획서 서비스 버전

## 1. 전제와 목표

### 1.1 서비스 전제
- 버전1 이용자에게 즉시 업그레이드를 제공해야 한다
- 이번 배포는 단계형 최소 기능 제품이 아니라 서비스 버전으로 출시한다
- 기능은 전부 포함하되, 운영 안정화를 위해 기능 단위 노출 제어와 긴급 중지 기능이 필요하다

### 1.2 무료와 유료의 범위
- 무료
  - 일일 퀴즈
  - 일일 독해
  - 수확 제작
  - 시즌 랭킹과 수상
  - 대결 모드
- 유료
  - 프로 모드
  - 농장별 모드
  - 지식과 지혜 글쓰기
  - 테스트 창고
  - 과제 바구니
  - 학습 보고서

### 1.3 핵심 목표
- 무료 이용자는 매일 학습 습관을 형성한다
- 유료 이용자는 커리큘럼, 시험, 리포트로 성과를 만든다
- 씨앗, 비료, 수확물 구조로 학습 동기, 시즌 경쟁, 대결 모드를 연결한다
- 버전1 이용자는 학습 이력과 보상을 유지한 채 서비스 버전으로 전환한다

---

## 2. 전체 서비스 구조

### 2.1 학습 종류
- 무료 학습
  - 일일 퀴즈
    - 개념
    - 배경지식
    - 어휘
  - 일일 독해
    - 문학
    - 비문학
- 유료 학습
  - 프로 모드
    - 소쉬르1부터 비트겐슈타인3
  - 테스트 창고
    - 진단 테스트(레벨 결정)
    - 프로 모드 챕터 종료 시험
  - 농장별 모드
    - 문법
    - 선택지 판별
    - 논리 사고력
    - 기타 확장 영역
  - 지식과 지혜
    - 글쓰기
    - 첨삭
  - 테스트 창고
    - 시험별 응시

### 2.2 경쟁과 보상 기능
- 누구나 참여
  - 시즌 랭킹과 수상
  - 대결 모드

### 2.3 게시판과 커뮤니티
- 학습 신청 게시판
- 커뮤니티 게시판
- 학습 질문 게시판
- 학습 자료 게시판
  - 학습 자료 공유와 다운로드
  - 자료는 관리자 승인형 운영을 기본값으로 한다

---

## 3. 경제 시스템

### 3.1 재화 정의
- 씨앗
  - 종류가 존재한다
  - 학습의 세부 영역에 따라 씨앗 종류가 고정된다
  - 같은 종류 씨앗 10개를 모으면 해당 작물을 수확할 수 있다
- 비료
  - 수확에 필수는 아니다
  - 수확량을 증가시키는 역할이다
  - 기본 획득 경로는 유료 학습의 챕터 확인 고사로 설계한다
- 수확물
  - 작물 단위로 보관한다
  - 시즌 랭킹과 대결 모드에서 사용한다

### 3.2 씨앗 지급 원칙
- 씨앗 종류는 학습 세부 영역별로 고정한다
- 완료한 학습의 세부 영역에 해당하는 씨앗이 지급된다
- 같은 날 여러 영역을 완료하면 여러 종류의 씨앗을 동시에 축적할 수 있다

### 3.3 수확 규칙
- 수확 제작은 무료다
- 기본 규칙
  - 같은 씨앗 10개를 소비하면 해당 작물을 1개 수확한다
- 비료 보너스 규칙
  - 비료를 함께 사용하면 같은 씨앗 10개로 해당 작물을 3개 수확한다
  - 비료 소비량은 1로 고정한다
- 무료 이용자도 무료 기능만으로 씨앗을 모아 수확물을 만들 수 있다

---

## 4. 시즌 랭킹과 수상

### 4.1 참여 정책
- 유료 여부와 상관없이 누구나 참여한다
- 시즌 산정은 레벨별로 분리한다

### 4.2 수확 기반 랭킹과 수상
수확 기반 랭킹
- 수확물 누적량 랭킹을 제공한다

시즌별 수상
- 수확왕
  - 시즌 기간 동안 수확물의 절대량 합계가 가장 많은 이용자
  - 레벨별로 수상자를 분리한다
- 수집왕
  - 시즌 기간 동안 수확물 보유량이 3개 이상인 작물 종류의 개수가 가장 많은 이용자
  - 레벨별로 수상자를 분리한다
- 농작왕
  - 출석 만점자
  - 레벨별로 수상자 수를 복수로 둘 수 있다

수상 산정 공통 규칙
- 시즌 종료 시점 인벤토리 기준 스냅샷을 기준으로 산정한다
- 대결 모드로 이동된 수확물도 최종 보유량에 반영된다

### 4.3 대결 기반 랭킹과 수상
대결 기반 랭킹
- 대결 모드의 승패 기록을 별도의 랭킹으로 제공한다
- 대결 랭킹은 레벨별, 시즌별로 제공한다
- 랭킹 지표
  - 승수
  - 패수
  - 승률
  - 연승
  - 참가 수
  - 몰수패 수

시즌별 수상
- 다승왕
  - 시즌 기간 동안 승수가 가장 많은 이용자
  - 레벨별로 수상자를 분리한다
- 승률왕
  - 시즌 기간 동안 최소 참가 수 조건을 만족한 이용자 중 승률이 가장 높은 이용자
  - 레벨별로 수상자를 분리한다
  - 최소 참가 수는 운영 설정으로 관리한다
- 연승왕
  - 시즌 기간 동안 최장 연승이 가장 긴 이용자
  - 레벨별로 수상자를 분리한다

대결 수상 산정 공통 규칙
- 시즌 종료 시점에 대결 전적 스냅샷을 생성하여 산정한다
- 대결은 정식 종료된 경기만 집계한다
- 탈락 구조 경기에서의 승리는 우승자에게 1승을 부여한다
- 우승이 아닌 참가자는 1패를 부여한다
- 2인 대결에서 상대 이탈로 인한 승패는 집계한다
- 부정행위 제재로 무효 처리된 경기는 집계에서 제외한다

---

## 5. 대결 모드 기능 요구사항

### 5.1 목적
- 같은 레벨 이용자끼리 실시간 퀴즈 대결을 제공한다
- 수확물을 스테이크로 걸고 승패에 따라 수확물이 이동한다
- 대결 전적 기반 시즌 랭킹과 수상을 제공한다

### 5.2 대기실과 정원
- 대기실이 존재한다
- 대기실 정원은 운영 설정으로 2명, 3명, 4명, 8명 중 선택할 수 있다
- 대기실은 두 방식으로 제공한다
  - 빠른 대결
    - 레벨, 정원, 스테이크 수량만 선택하고 자동 매칭
  - 방 만들기
    - 방장이 레벨, 정원, 스테이크 수량을 고정하고 방 코드를 공유

### 5.3 스테이크 규칙
- 스테이크로 거는 수확물은 참가자마다 종류가 달라도 된다
- 스테이크 수량은 참가자 전원이 같아야 한다
- 스테이크 수량은 대기실 생성 시 고정된다
- 매칭 시작 시 각 참가자의 스테이크 수확물은 에스크로로 잠긴다

### 5.4 경기 규칙
공통
- 동일 문항을 동시에 제시한다
- 각 문항마다 제한 시간이 있다
- 정답 제출은 서버 시간으로 기록한다
- 경기 중 정답 정보는 노출하지 않는다

2인 대결
- 한쪽만 오답 또는 제한 시간 초과이면 그 이용자가 패배한다
- 둘 다 정답이면 다음 문항으로 진행한다
- 둘 다 오답 또는 제한 시간 초과이면 다음 문항으로 진행한다

3인 이상 대결
- 매 문항마다 오답 또는 제한 시간 초과한 이용자는 탈락 후보가 된다
- 해당 문항에서 정답자가 1명 이상 존재할 때만 탈락이 발생한다
- 해당 문항에서 전원이 오답 또는 제한 시간 초과이면 탈락 없이 다음 문항으로 진행한다
- 최후의 1인이 우승하며, 모든 스테이크 수확물을 획득한다

이탈과 연결 끊김
- 서버는 재접속 유예 시간을 제공한다
- 유예 시간 내 복귀하지 않으면 제한 시간 초과로 처리한다
- 2인 대결에서는 해당 이용자가 패배한다
- 3인 이상 대결에서는 해당 이용자가 탈락 후보가 되며, 정답자가 존재한 문항이면 즉시 탈락한다

경기 종료와 정산
- 우승자가 결정되면 즉시 종료한다
- 에스크로를 해제하고 우승자에게 모든 스테이크를 지급한다
- 운영 수수료는 0으로 시작하고 필요 시 설정값으로 도입한다

### 5.5 부정행위 방지
- 정답 판정은 서버가 한다
- 시간 측정은 서버 시간을 기준으로 한다
- 정답 정보는 경기 종료 전까지 전달하지 않는다
- 이상 패턴 탐지
  - 비정상적으로 빠른 응답
  - 반복적인 동일 상대 매칭
  - 연결 끊김을 악용한 회피
- 제재
  - 대결 모드 일시 정지
  - 대결 랭킹 집계 제외
  - 시즌 랭킹 제외
  - 계정 제재

---

## 6. 화면 구조

### 6.1 하단 탭
- 홈
- 무료 학습
- 유료 학습
- 대결
- 커뮤니티
- 쇼핑몰

### 6.2 홈
- 오늘의 무료 학습 바로가기
- 씨앗 보관함, 비료, 수확물 보관함
- 시즌 랭킹 요약
  - 수확 랭킹 요약
  - 대결 랭킹 요약
- 대결 모드 바로가기
- 버전1 업그레이드 안내

### 6.3 무료 학습
- 일일 퀴즈
- 일일 독해
- 오늘의 씨앗 획득 내역

### 6.4 유료 학습
- 과제 바구니
- 프로 모드
- 농장별 모드
- 지식과 지혜
- 테스트 창고
- 수확 장부

### 6.5 대결
- 대기실
  - 빠른 대결
  - 방 만들기
- 경기 화면
- 결과와 정산
- 대결 랭킹
  - 레벨별 시즌 랭킹
  - 다승왕, 승률왕, 연승왕

### 6.6 커뮤니티
- 학습 신청 게시판
- 커뮤니티 게시판
- 학습 질문 게시판
- 학습 자료 게시판

---

## 7. 접근 권한과 결제 정책

### 7.1 권한 상태
- 게스트
  - 무료 학습 미리보기
  - 대결 모드는 회원만 허용하는 것을 기본값으로 한다
- 무료 회원
  - 무료 학습, 수확 제작, 시즌, 대결 이용 가능
- 유료 회원
  - 유료 학습과 시험, 리포트 이용 가능
  - 과제 바구니 이용 가능

### 7.2 과제 바구니 유료 기능
- 유료 회원에게 과제 바구니 메뉴를 제공한다
- 과제 바구니는 배정된 과제를 모아 보여주는 개인 전용 목록이다
- 과제 유형
  - 프로 모드 특정 레벨과 챕터 지정
  - 농장별 모드 세션 지정
  - 글쓰기 과제 지정
  - 테스트 창고 시험 지정

### 7.3 과제 배정 권한과 역할
- 과제 배정자는 다음 두 유형을 포함한다
  - 본사 관리자
  - 제휴기관 관리자
- 제휴기관 관리자는 기관 단위로 사용자와 반을 관리한다
- 과제는 개인, 반, 기관 전체를 대상으로 배정할 수 있다
- 과제 배정 기능은 관리자 모드에서 제공한다

---

## 8. 버전1에서 버전2로의 업그레이드

### 8.1 업그레이드 원칙
- 로그인 계정과 인증 체계는 유지한다
- 학습 진행률과 점수는 유실 없이 이전한다
- 씨앗과 수확물, 비료 잔고는 그대로 유지한다
- 유료 권한은 자동 승계한다

### 8.2 씨앗 종류 전환
- 버전1에서 씨앗이 단일 수치였다면
  - 버전2에서는 초기 씨앗을 세부 영역 고정 씨앗으로 변환한다
  - 변환 방식은 운영 설정으로 관리한다

---

## 9. 데이터 설계 원칙

### 9.1 콘텐츠와 시도 분리
- 콘텐츠 데이터는 정적이다
- 시도 데이터는 사용자별로 누적된다

### 9.2 공통 키
- content_id
- activity_id
- user_id
- attempt_id
- season_id
- level_id
- chapter_id
- match_id
- org_id
- class_id

---

## 10. JSON 데이터 구조

### 10.1 공통 메타

```json
{
  "meta": {
    "schema_version": "1.4.0",
    "created_at": "2026-01-18T00:00:00+09:00",
    "updated_at": "2026-01-18T00:00:00+09:00"
  }
}
```

### 10.2 씨앗 카탈로그와 영역 매핑

```json
{
  "seed_catalog": {
    "seed_types": [
      {"seed_type": "seed_wheat", "name": "밀 씨앗", "crop_type": "crop_wheat", "rarity": "common", "season_point": 1},
      {"seed_type": "seed_oat", "name": "귀리 씨앗", "crop_type": "crop_oat", "rarity": "common", "season_point": 1},
      {"seed_type": "seed_rice", "name": "쌀 씨앗", "crop_type": "crop_rice", "rarity": "common", "season_point": 1},
      {"seed_type": "seed_grape", "name": "포도 씨앗", "crop_type": "crop_grape", "rarity": "rare", "season_point": 2}
    ],
    "area_to_seed": [
      {"activity_type": "daily_reading", "genre": "nonfiction", "subarea": "philosophy", "seed_type": "seed_wheat"},
      {"activity_type": "daily_reading", "genre": "nonfiction", "subarea": "economics", "seed_type": "seed_oat"},
      {"activity_type": "daily_reading", "genre": "literature", "subarea": "modern_poetry", "seed_type": "seed_rice"},
      {"activity_type": "daily_quiz", "category": "background_knowledge", "subarea": "information_technology", "seed_type": "seed_grape"}
    ]
  }
}
```

### 10.3 씨앗 지급 규칙

```json
{
  "seed_reward_rule": {
    "rule_id": "seed_by_area_v1",
    "grant_once_per_day": true,
    "grant": {"seed_count": 2, "seed_type_source": "area_to_seed"},
    "notes": "해당 활동의 세부 영역에 매핑된 씨앗을 고정 지급한다"
  }
}
```

### 10.4 사용자 인벤토리

```json
{
  "inventory": {
    "user_id": "u_1001",
    "seeds": {"seed_wheat": 8, "seed_oat": 12, "seed_rice": 2, "seed_grape": 0},
    "fertilizer": 1,
    "crops": {"crop_wheat": 4, "crop_oat": 1, "crop_rice": 0, "crop_grape": 1}
  }
}
```

### 10.5 수확 제작 레시피

```json
{
  "harvest_recipe": {
    "recipe_id": "hr_seed10",
    "craft_access": "all",
    "seed_required": 10,
    "without_fertilizer": {"fertilizer_spent": 0, "multiplier": 1},
    "with_fertilizer": {"fertilizer_spent": 1, "multiplier": 3},
    "limits": {"max_crafts_per_day": 30}
  }
}
```

### 10.6 대결 모드 설정

```json
{
  "duel_mode_config": {
    "mode_id": "duel_quiz_realtime",
    "access": "all",
    "title": "실시간 퀴즈 대결",
    "room_sizes": [2, 3, 4, 8],
    "matchmaking": {"same_level_only": true, "queue_timeout_seconds": 60, "rating": {"enabled": true, "system": "elo"}},
    "rules": {
      "question_time_limit_seconds": 12,
      "max_questions": 80,
      "disconnect_grace_seconds": 20,
      "two_player": {"both_wrong_policy": "next_question", "one_wrong_policy": "wrong_loses"},
      "multi_player": {"elimination_policy": "wrong_eliminates_if_any_correct", "all_wrong_policy": "next_question_no_elimination"}
    },
    "stake": {
      "currency": "crop",
      "stake_amount_fixed_per_room": true,
      "crop_type_per_player": "allowed_different",
      "min_amount": 1,
      "max_amount": 20,
      "fee_rate": 0.0
    }
  }
}
```

### 10.7 학습 자료 게시판 글

```json
{
  "learning_material_post": {
    "post_id": "lm_10001",
    "board": "learning_materials",
    "org_scope": "public",
    "title": "프레게1 문장 독해 연습 자료",
    "content": "자료 설명과 사용 안내.",
    "attachments": [
      {"file_id": "f_9001", "name": "worksheet.pdf", "mime": "application/pdf", "size": 1048576}
    ],
    "tags": ["frege1", "sentence_reading"],
    "status": "pending_review",
    "created_by": {"user_id": "u_org_01", "role": "ORG_ADMIN"},
    "created_at": "2026-01-18T21:00:00+09:00",
    "review": {"approved": false, "reviewed_by": null, "reviewed_at": null, "comment": null}
  }
}
```

### 10.8 대결 전적 집계

```json
{
  "duel_stats": {
    "season_id": "season_2026_spring_01",
    "level_id": "frege1",
    "user_id": "u_1003",
    "matches": 42,
    "wins": 26,
    "losses": 16,
    "win_rate": 0.6190,
    "current_streak": 3,
    "best_streak": 9,
    "forfeit_losses": 1,
    "updated_at": "2026-02-01T18:00:00+09:00"
  }
}
```

### 10.9 대결 시즌 랭킹

```json
{
  "duel_season_leaderboard": {
    "season_id": "season_2026_spring_01",
    "level_id": "frege1",
    "generated_at": "2026-02-01T18:00:00+09:00",
    "minimum_matches_for_win_rate": 20,
    "leaderboards": {
      "wins": [
        {"rank": 1, "user_id": "u_1003", "value": 26},
        {"rank": 2, "user_id": "u_1001", "value": 24}
      ],
      "win_rate": [
        {"rank": 1, "user_id": "u_1011", "value": 0.8125, "matches": 32},
        {"rank": 2, "user_id": "u_1003", "value": 0.6190, "matches": 42}
      ],
      "best_streak": [
        {"rank": 1, "user_id": "u_1003", "value": 9},
        {"rank": 2, "user_id": "u_1052", "value": 8}
      ]
    }
  }
}
```

### 10.10 시즌 수상 스냅샷

```json
{
  "season_award_snapshot": {
    "season_id": "season_2026_spring_01",
    "captured_at": "2026-05-31T23:59:59+09:00",
    "by_level": {
      "frege1": {
        "harvest_awards": {
          "harvest_king": {"user_id": "u_1002", "total_crops": 183},
          "collector_king": {"user_id": "u_1011", "eligible_crop_types": 9, "min_count_per_type": 3},
          "attendance_king": {"user_ids": ["u_1030", "u_1044", "u_1052"], "days": 92}
        },
        "duel_awards": {
          "wins_king": {"user_id": "u_1003", "wins": 110},
          "win_rate_king": {"user_id": "u_1011", "win_rate": 0.8125, "matches": 32, "min_matches": 20},
          "streak_king": {"user_id": "u_1052", "best_streak": 14}
        }
      }
    }
  }
}
```

---

## 11. 서버 구성과 운영자 기능

### 11.1 대결 모드 서버 구성
- 실시간 통신
  - 웹소켓 기반
  - 서버가 세션 상태를 권한 있게 유지한다
- 매칭 서비스
  - 레벨별 큐
  - 대기실 기반 매칭
  - 레이팅 기반 우선 매칭
- 정산 서비스
  - 에스크로 잠금
  - 결과 확정 후 지급
- 전적 집계 서비스
  - 경기 종료 이벤트를 기반으로 승패 기록을 누적한다
  - 시즌별, 레벨별 전적을 집계한다
  - 승률 조건과 최소 참가 수 조건을 적용한다

### 11.2 관리자 모드 개요
- 관리자 모드는 두 종류다
  - 본사 관리자 모드
  - 제휴기관 관리자 모드

공통 원칙
- 모든 관리 기능은 기관 컨텍스트를 가진다
- 본사 관리자는 모든 기관의 데이터에 접근할 수 있다
- 제휴기관 관리자는 자신의 기관 데이터에만 접근할 수 있다
- 데이터 권한은 생성 주체와 소유 기관을 기준으로 한다

역할
- HQ_ADMIN
  - 본사 관리자
- ORG_ADMIN
  - 제휴기관 관리자
- TEACHER
  - 기관 내 교사 역할
- STUDENT

### 11.3 관리자 모드 기능 목록

학생 관리
- 학생 계정 생성, 초대, 비활성화
- 학생 기본 정보 편집
- 학생 소속 기관 지정과 변경

수강반 관리
- 수강반 생성, 수정, 삭제
- 학생은 복수의 수강반에 등록 가능
- 필터 시스템
  - 학년대
  - 레벨
  - 요일
  - 담당자
  - 시작일
  - 상태
  - 태그
- 수강반별 학생 명단 관리

학습 데이터 관리
- 권한 규칙
  - 본사 관리자는 전체 학습 데이터 생성, 수정, 삭제 가능
  - 제휴기관 관리자는 본사 생성 학습 데이터 열람 가능
  - 제휴기관 관리자는 기관 생성 학습 데이터 생성, 수정, 삭제 가능
- 학습 데이터 등록 방식
  - 학습 유형 선택 후 JSON 업로드
  - 업로드 시 스키마 검증과 필수 필드 검증
  - 열람 시 학습 미리 보기 제공

과제 배정
- 수강반별 과제 배정
- 학생별 과제 배정
- 마감일, 완료 조건, 재제출 규칙 설정

과제 현황
- 수강반별 특정 기간 과제 수행 및 완료 현황
- 학생별 특정 기간 과제 수행 및 완료 현황
- 미수행자, 미완료자, 지연자 필터

학생별 코멘트
- 학생마다 날짜 지정 코멘트 입력, 수정, 삭제
- 코멘트 학생 공개 여부 설정

학생 글쓰기 첨삭
- 지식과 지혜 글쓰기 제출물 열람
- 학생별 첨삭 입력과 수정
- 루브릭 점수와 피드백 코멘트

테스트 채점
- 시험지 PDF 업로드
- 정답 입력
- 채점과 분석
- 시험지별 통계
  - 평균
  - 표준편차
  - 문항 난이도
  - 문항 변별도
  - 영역별 통계
  - 오답 분포

학생 카드 열람
- 학생별 보고서
  - 학생 정보
  - 학습 수행 수
  - 수행 시간
  - 학습 히스토리
  - 학습 정확도
  - 학습 영역별 통계
  - 테스트 결과
  - 테스트 통계
  - 테스트 영역별 통계
  - 테스트 히스토리
  - 지식과 지혜 히스토리
  - 첨삭 내용
  - 코멘트 내용

제휴기관 관리
- 본사 관리자만 가능
- 기관 생성, 수정, 비활성화
- 기관 플랜, 결제 상태, 좌석 수 관리
- 기관별 관리자 계정 관리

쇼핑몰 관리
- 교재 및 교구 쇼핑몰 등록은 본사 관리자만 가능
- 상품 등록, 수정, 삭제
- 재고, 배송, 가격 관리

판매 및 결제 현황
- 본사 관리자만 가능
- 교재 및 교구 판매 현황
- 개인 회원 결제 내역
- 제휴기관 결제 내역

게시판 관리
- 학습 자료 게시판 승인과 반려
- 게시판 공지 등록
- 신고 처리와 제재

대결 랭킹 관리
- 대결 시즌 설정
- 최소 참가 수 조건 설정
- 승률왕, 다승왕, 연승왕 산정 스냅샷 생성
- 부정행위 제재 반영 후 재집계

---

## 12. 구현을 위한 최소 API 목록

인증
- 회원가입
- 로그인
- 권한 조회
- 역할 조회

무료 학습
- 일일 퀴즈 조회, 제출
- 일일 독해 조회, 제출
- 씨앗 지급 처리

경제
- 인벤토리 조회
- 수확 제작
- 거래 장부 기록

시즌
- 시즌 조회
- 수확 랭킹 조회
- 수확 수상 조회
- 대결 랭킹 조회
- 대결 수상 조회

대결 모드
- 대기실 생성
- 대기실 목록과 방 코드 조회
- 대기실 입장, 퇴장
- 빠른 대결 큐 입장, 퇴장
- 실시간 경기 연결
- 답안 제출
- 생존자 상태 브로드캐스트
- 에스크로 잠금과 정산
- 대결 전적 조회
- 대결 시즌 랭킹 조회

유료 학습
- 프로 모드
- 농장별 모드
- 지식과 지혜
- 테스트 창고
- 수확 장부

과제
- 과제 생성, 발행, 수정, 종료
- 과제 대상 지정, 마감 설정
- 과제 바구니 조회
- 과제 진행률 조회
- 과제 제출
- 제출물 검토, 피드백

게시판
- 게시판 목록 조회
- 게시글 조회, 작성, 수정, 삭제
- 첨부 파일 업로드, 다운로드
- 댓글 조회, 작성, 삭제
- 신고
- 학습 자료 게시판 승인, 반려

관리자 모드
- 기관 생성, 수정, 비활성화 본사 전용
- 기관 플랜과 좌석 수 관리 본사 전용
- 기관 관리자 계정 관리
- 학생 관리
- 수강반 관리
- 학생 수강반 다중 등록
- 필터 시스템
- 학습 데이터 업로드, 검증, 미리 보기
- 학습 데이터 권한 기반 수정과 삭제
- 과제 배정 수강반별, 학생별
- 과제 현황 조회 수강반별, 학생별, 기간 필터
- 학생 코멘트 생성, 수정, 삭제
- 글쓰기 첨삭 생성, 수정
- 테스트 PDF 업로드, 정답 입력, 채점, 분석, 통계
- 학생 카드 조회
- 대결 전적 집계 재처리
- 대결 수상 스냅샷 생성
- 쇼핑몰 상품 등록, 수정, 삭제 본사 전용
- 쇼핑몰 판매 현황 본사 전용
- 개인 결제 내역 본사 전용
- 제휴기관 결제 내역 본사 전용

커뮤니티
- 게시글, 댓글, 신고

쇼핑몰
- 상품, 주문, 결제, 배송

---

## 13. AWS 기반 기술 스택

### 13.1 인프라 구성 요약
- 백엔드 서버
  - AWS EC2
  - Spring Boot
  - Kotlin
  - JDK 17
- 데이터베이스
  - AWS RDS
  - MySQL
- 프론트엔드
  - AWS Amplify
  - React 19.2.1
  - JavaScript
- 콘텐츠 저장소
  - AWS S3
- 랭킹 저장
  - Redis
  - 초기 구성은 백엔드와 동일한 EC2 내 구성
  - 안정화 이후에는 AWS ElastiCache Redis로 분리 가능

### 13.2 앱 개발로의 확장 가능성
- 백엔드와 데이터 계층은 그대로 유지한다
- 웹 프론트와 동일 API를 호출하는 iOS와 Android 클라이언트를 추가하면 된다
- 웹은 Amplify, 앱은 앱스토어와 플레이스토어 배포로 분리한다

---

## 14. 레포지토리와 파일 구조

권장 구조는 모노레포다. 웹과 앱을 최대한 재사용하기 위해 프론트와 모바일 래퍼를 한 저장소에서 관리한다.

```
root
  backend
    build.gradle.kts
    src
      main
        kotlin
        resources
      test
    docker
      Dockerfile
    scripts
      deploy
    docs
  frontend
    package.json
    src
    public
    build
    amplify
  mobile
    capacitor.config.json
    ios
    android
    scripts
      build
      release
  infra
    environments
      dev
      prod
    templates
    runbooks
  shared
    api
      openapi
    contracts
      json-schemas
```

파일 구조 원칙
- backend는 API 서버와 웹소켓 대결 서버를 포함한다
- frontend는 웹 사용자 화면을 담당한다
- mobile은 Capacitor 기반의 iOS, Android 네이티브 프로젝트를 포함한다
- infra는 배포 환경 설정, 운영 절차서, 자동화 스크립트를 포함한다
- shared에는 API 계약과 JSON 스키마를 단일 소스로 보관한다

---

## 15. AWS 배포 아키텍처

### 15.1 권장 네트워크 구조
- VPC
  - 퍼블릭 서브넷
    - ALB
    - NAT 게이트웨이 필요 시
  - 프라이빗 서브넷
    - EC2 백엔드
    - RDS MySQL

### 15.2 트래픽 흐름
- 웹
  - 사용자는 Amplify로 배포된 React 정적 자산을 받는다
  - 브라우저는 API 도메인으로 백엔드를 호출한다
- API
  - ALB가 HTTPS를 종료하고 EC2로 라우팅한다
  - Spring Boot가 REST API와 실시간 대결용 웹소켓을 제공한다
- 파일
  - 업로드는 프리사인드 URL 방식으로 S3에 직접 업로드한다
  - 다운로드는 S3 또는 CloudFront 배포로 제공한다
- 랭킹
  - 백엔드가 Redis에 랭킹을 저장한다

### 15.3 필수 보안과 운영 구성
- 도메인과 인증서
  - ACM으로 TLS 인증서를 관리한다
  - ALB에서 HTTPS를 강제한다
- 비밀 관리
  - 데이터베이스 계정, 서드파티 키, 시크릿은 Secrets Manager 또는 Parameter Store로 관리한다
- 관측성
  - CloudWatch 로그, 지표, 알람
  - 대결 모드 웹소켓 연결 수, 지연, 오류율을 별도 지표로 본다
- 권한
  - S3 업로드는 서버가 발급한 프리사인드 URL로만 허용한다
  - 관리자 기능은 역할 기반 접근 제어로 제한한다

---

## 16. CI/CD와 배포 흐름

### 16.1 프론트엔드
- Amplify와 Git 저장소를 연결한다
- 브랜치별 환경을 분리한다
  - main은 운영
  - develop은 개발
- 빌드 단계
  - 테스트
  - 빌드
  - 배포

### 16.2 백엔드
권장 방식은 Docker 기반 배포다.
- 빌드
  - Gradle로 테스트와 빌드를 수행한다
  - Docker 이미지로 패키징한다
- 배포
  - ECR에 이미지를 푸시한다
  - EC2에서 이미지를 풀 받아 실행한다
  - 무중단 배포를 위해 ALB 대상 그룹을 활용한다

데이터베이스 마이그레이션
- Flyway 또는 Liquibase를 사용한다
- 배포 파이프라인에서 마이그레이션을 선행 적용한다

### 16.3 운영 안정 장치
- 기능 노출 제어
  - 플래그 기반으로 기능 단위 노출을 제어한다
- 긴급 중지
  - 대결 모드, 결제, 업로드 등 고위험 기능은 원클릭 중지 가능해야 한다

---

## 17. 모바일 앱 동시 출시 전략

### 17.1 기본 전략
- 웹 프론트 코드를 최대한 재사용한다
- Capacitor로 React 웹을 iOS, Android 앱으로 패키징한다
- 앱에서 호출하는 API는 웹과 동일한 백엔드를 사용한다

### 17.2 앱에서 반드시 구현해야 하는 기능
앱 심사 리스크를 낮추기 위해 앱 고유 기능을 포함한다.
- 로그인 유지
  - 토큰은 보안 저장소에 저장한다
- 푸시 알림
  - 과제 마감, 시즌 종료, 대결 초대 등
- 카메라 기반 제출
  - 과제, 테스트 답안, 글쓰기 첨삭용 파일 업로드
- 오프라인 사용 경험
  - 일일 독해와 학습 자료 일부를 오프라인 저장 후 열람 가능하게 한다
- 딥링크
  - 과제, 대결 초대, 게시판 글로 바로 이동

### 17.3 결제와 구독 처리
- 웹 결제와 앱 결제는 분리 정책을 가진다
- iOS에서는 디지털 콘텐츠 구독과 결제에 인앱 결제가 요구될 수 있다
- 운영 정책을 단순화하려면 앱에는 스토어 결제를 기본값으로 두고, 웹은 카드 결제를 유지한다
- 구독 상태는 서버에서 단일하게 판정하고, 스토어 영수증 검증을 서버가 수행한다

### 17.4 대결 모드 모바일 품질 기준
- 웹소켓 연결
  - 백그라운드 전환, 네트워크 변경, 재접속을 안정적으로 처리한다
- 지연과 공정성
  - 시간 판정은 서버 기준으로만 수행한다

---

## 18. 출시 체크리스트

### 18.1 공통
- 개인정보 처리방침과 이용약관
- 아동 사용자 고려
  - 보호자 동의 흐름
  - 커뮤니티 신고와 차단
- 로그와 보안
  - 민감 정보 로그 금지
  - 비정상 접근 차단

### 18.2 iOS
- 앱 아이콘과 스플래시
- 푸시 알림 권한 문구
- 결제와 구독 정책 문구
- 심사용 테스트 계정 제공

### 18.3 Android
- 서명 키 관리
- 권한 요청 최소화
- 심사용 테스트 계정 제공

