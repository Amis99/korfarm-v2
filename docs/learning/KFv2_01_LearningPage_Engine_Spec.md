# 국어농장 v2 학습 페이지 엔진 규격서

## 1. 범위
본 문서는 학습 페이지 기획 최종안에 포함된 학습들을 한 엔진에서 구동하기 위한 공통 규격을 정의합니다.

## 2. 공통 화면 구조

### 2.1 화면 레이아웃 표준
- 상단: 지문 박스 또는 시험지 배경 영역
- 중앙: 상호작용 영역
  - 하이라이트 대상 텍스트
  - 박스형 정답 입력 영역
  - 카드 영역, 원고지 영역, 음운 박스 영역 등
- 하단: 푸터
  - 타임바
  - 제출, 다음, PDF 보기, 종료 버튼

### 2.2 공통 UI 요소 정의
- 하이라이트
  - 색상 종류는 데이터에서 지정 가능
  - 하이라이트는 순차 진행이 기본
- 모달
  - 질문, 선택지, 진행 단계 표시
  - 모달이 떠 있을 때도 배경은 유지
- 채점 표시
  - 정답: 동그라미 채점 표시
  - 오답: 사선 그음 표시
  - 표시 방식은 학습 유형별로 다르지만 엔진이 공통 인터페이스로 제공

## 3. 공통 학습 상태 모델

### 3.1 상태
- READY: 데이터 로드 완료, 시작 대기
- RUNNING: 타임바 진행, 단계 실행 중
- PAUSED: 사용자가 PDF 보기 등으로 일시 전환, 타임바는 학습 유형 규칙에 따라 유지 또는 정지
- FINISHED: 성공 종료 또는 실패 종료
- ABORTED: 사용자가 종료

### 3.2 공통 이벤트
- START
- ANSWER_SUBMIT
- ANSWER_CORRECT
- ANSWER_WRONG
- STEP_NEXT
- TIME_EXPIRED
- SEED_EARN
- END_SUCCESS
- END_FAIL

## 4. 타임바 규격

### 4.1 기본
- 학습 시작과 동시에 감소
- 0이 되면 즉시 종료

### 4.2 정답 오답에 따른 증감
- 학습 유형별로 단위 초가 다릅니다.
- 대표 규칙
  - 독해 정독형: 정답 +20초, 오답 -20초
  - 확인 학습: 정답 +30초, 오답 -30초
  - 형태 분석, 문장 성분 등: 정답 +20초, 오답 -20초
  - 선택지 판별: 명제 근거 찾기 성공 +20초, 실패 -20초

## 5. 학습 로그와 결과 요약

### 5.1 수집해야 하는 로그
- 사용자 정보, 학습 콘텐츠 식별자, 학습 시작 시간, 종료 시간
- 단계별 로그
  - stepId
  - promptId
  - 선택지 id
  - 정오답
  - 소요 시간
  - 하이라이트 대상 id
  - 클릭 좌표 또는 클릭한 토큰 id, 필요한 유형만 저장

### 5.2 결과 요약 형식
- 정확도, 정답 수, 오답 수, 진행률, 총 소요 시간
- 학습 유형별 확장 필드
  - 복기 학습: 카드 배치 결과
  - 음운 변동: 칸 수정 히스토리
  - 선택지 판별: 선택지별 명제 OX 내역

## 6. 하이라이트 및 입력 판정 규칙

### 6.1 텍스트 클릭 판정
- 지문 내부에서 특정 표현을 클릭하면 정답 처리하는 유형이 있습니다.
- 동일 문자열이 지문에 여러 번 등장할 수 있으므로, 단순 문자열 매칭으로 처리하지 않습니다.
- 데이터가 제공한 위치 범위 안에서의 클릭만 정답으로 인정합니다.

### 6.2 카드 이동
- 복기 학습은 요약 카드들을 빈 지문 박스에 배치하는 방식입니다.
- 제출 시 정답 순서 여부를 판단합니다.
- 오답 시 정답 위치 카드 표시 후 씨앗 하나를 삭제하며 씨앗이 0이면 종료합니다.

## 7. 학습 유형별 실행 모델 요약

### 7.1 독해 정독형
- 문장이 순차 하이라이트되고 모달에 질문이 뜹니다.
- 오답 시 선택한 선택지를 제거하고 남은 선택지로 계속 풉니다.
- 정답을 맞혀야 다음 하이라이트로 넘어갑니다.

### 7.2 선택지 판별형
- 선택지를 누르면 명제로 분해된 카드가 모달에 순차 제시됩니다.
- 각 명제의 근거를 지문에서 찾아 클릭합니다.
- 정답이면 지문 구절을 하이라이트하고 모달에 OX 카드가 붙습니다.
- 선택지가 정답이 아니라면 선택지에 O 또는 X 표시를 남기고 다른 선택지를 진행합니다.

### 7.3 음운 변동 박스형
- 시험지에는 번호를 표시하지 않지만 내부적으로 칸에 번호가 있으며 데이터가 그 번호를 지정합니다.
- 환경 칸은 초록색, 대상 칸은 파란색 하이라이트입니다.
- 정답이면 해당 칸의 음운을 수정하고 다음 질문으로 진행합니다.

### 7.4 형태소 및 단어 형성형
- 먼저 형태소 개수, 다음으로 형태소 이름, 다음으로 어근 접사 어미 구분을 순차로 묻습니다.
- 어근은 동그라미, 접사는 네모 표시를 적용합니다.
- 추가 결합 판단과 합성어 파생어 판단을 반복 단계로 진행합니다.

### 7.5 문장의 짜임 분석형
- 서술어1을 기준으로 호응 성분을 찾도록 유도합니다.
- 1, 2, 3 이상의 번호가 섞이면 오답 처리하는 규칙이 있습니다.
- 안긴 문장, 이어진 문장 판단 후 괄호, 슬러시 등을 표시합니다.

## 8. 엔진 인터페이스

### 8.1 프런트엔드 구성 단위
- EngineShell
- StageRenderer
- HighlightLayer
- ModalLayer
- TimeBar
- ActionFooter
- ResultSummary

### 8.2 학습 모듈 인터페이스
각 학습 유형은 아래 함수를 구현합니다.

- init
- getInitialState
- renderScene
- onUserAction
- judge
- applyResult
- isFinished
- buildSummary

## 9. 코딩 에이전트 지시문

코덱스 또는 클로드코드에 아래 작업을 순서대로 실행하도록 지시합니다.

1. EngineShell, TimeBar, ModalLayer 공통 구현
2. 텍스트 하이라이트 레이어 구현
3. 학습 모듈 인터페이스 적용
4. 독해 정독형 모듈 구현
5. 복기 학습 카드 모듈 구현
6. 확인 학습 클릭 판정 모듈 구현
7. 선택지 판별 모듈 구현
8. 음운 변동 박스 모듈 구현
9. 형태소, 단어 형성, 문장 짜임 모듈 구현
10. 결과 요약, 로그 전송, 씨앗 지급 연동
