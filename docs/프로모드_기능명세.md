# 프로 모드 기능 명세 보고서

## 1. 개요

**프로 모드**는 국어농장v2의 핵심 유료 상품으로, 구독 회원 전용 학습 코스다. 소쉬르1(초1)부터 비트겐슈타인3(고3)까지 12레벨 체계에 맞춘 체계적 학습을 제공하며, 종이 교재와 연동되는 온라인 학습 + 챕터별 테스트 + 성적 분석으로 구성된다.

**현재 상태**: `/pro-mode` 라우트에 스텁 페이지("준비 중")만 존재. 백엔드에 프로 모드 전용 로직 없음.

---

## 2. 교재 구조

### 2.1 기본 구성
- **레벨당 5권**, 1권당 4챕터 → **레벨당 총 20챕터**
- 12레벨 x 20챕터 = **총 240챕터**

### 2.2 챕터 구성 (레벨별 차이)

| 레벨군 | 대상 | 챕터 내 섹션 구성 |
|--------|------|-------------------|
| **소쉬르** (초등) | 초1~초3 | *(별도 구성 — 추후 정의 필요)* |
| **프레게** (초등 고학년) | 초4~초6 | *(별도 구성 — 추후 정의 필요)* |
| **러셀** (중학생) | 중1~중3 | 문법, 국어 개념, 문학, 비문학 |
| **비트겐슈타인** (고등) | 고1~고3 | *(별도 구성 — 추후 정의 필요)* |

### 2.3 교재와 온라인의 관계
- 종이 교재: 활동과 문제만 수록 (모범 답안 / 정답·해설 **없음**)
- 온라인(프로 모드): 교재의 모든 학습을 완료해야 해당 챕터의 **모범 답안 + 정답·해설 열람 가능**
- 종이 교재는 별도 쇼핑몰 상품으로 판매 예정 (현재 원고 작업 완료, 디자인 진행 예정)

---

## 3. 프로 모드 학습 플로우

### 3.1 진입 구조

```
프로 모드 메인 (/pro-mode)
  └─ 사용자 레벨 자동 감지 (profile.level)
      └─ 챕터 목록 (게시판 형태, 진도에 맞는 챕터 표시)
          └─ 챕터 상세 (학습 아이템 목록)
              ├─ [활성] 독해 모드 (챕터 내 모든 지문)
              ├─ [활성] 어휘 학습
              ├─ [활성] 배경지식 학습
              ├─ [활성] 논리 사고력 학습 (비트겐슈타인: 선택지 판별)
              ├─ [잠금] 모범 답안 / 정답·해설 ← 위 학습 모두 완료 시 해제
              └─ [잠금] 챕터별 테스트 ← 위 학습 모두 완료 시 해제
```

### 3.2 챕터 내 학습 아이템 상세

각 챕터는 교재 섹션에 대응하는 학습 아이템들을 포함한다.

| # | 학습 유형 | 설명 | 활성 조건 | 보상 |
|---|-----------|------|-----------|------|
| 1 | **독해 모드** | 챕터 내 모든 글(문법/개념/문학/비문학 지문) 독해 훈련 | 처음부터 활성 | 씨앗 또는 비료 |
| 2 | **어휘 학습** | 해당 챕터 관련 어휘 | 처음부터 활성 | 씨앗 또는 비료 |
| 3 | **배경지식 학습** | 해당 챕터 관련 배경지식 | 처음부터 활성 | 씨앗 또는 비료 |
| 4 | **논리 사고력** | 논리 추론 (비트겐슈타인: 선택지 판별) | 처음부터 활성 | 씨앗 또는 비료 |
| 5 | **모범 답안 / 정답·해설** | 교재에 없는 해답 열람 | 1~4 **모두 완료** 시 해제 | - |
| 6 | **챕터별 테스트** | 인쇄 → OMR 입력 → 자동 채점 | 1~4 **모두 완료** 시 해제 | - |

### 3.3 잠금 해제 로직
- 학습 아이템 1~4를 **모두** 완료해야 아이템 5(답안·해설)와 6(테스트) 활성화
- 5, 6은 리스트에 처음부터 보이되, **비활성 상태**로 표시 (흐리게 + 자물쇠 아이콘 등)
- 완료 여부는 기존 `farm/complete` API의 학습 완료 기록 또는 프로 모드 전용 진행 추적으로 판단

---

## 4. 챕터별 테스트

### 4.1 응시 플로우

```
챕터 학습 완료 (1~4 모두)
  └─ 챕터별 테스트 활성화
      └─ 리스트에서 클릭
          └─ [인쇄하기] 버튼만 표시 (미리보기 불가)
              └─ 인쇄 실행
                  └─ 1시간 타이머 시작
                      └─ [OMR 작성] 버튼 활성화
                          └─ 답안 입력 (기존 TestOmrPage 재활용 가능)
                              └─ 제출 → 자동 채점
                                  ├─ 70점 이상 → 통과 → 다음 챕터 해제
                                  └─ 70점 미만 → 재응시 (다른 버전)
```

### 4.2 핵심 제약사항
- **미리보기 불가**: 시험지 PDF를 화면에 표시하지 않음, 인쇄만 가능
- **시간 제한**: 인쇄 후 **1시간 이내** OMR 작성 필수
- **자동 만료**: 1시간 경과 시 해당 세션 자동 만료 (재응시 필요)

### 4.3 통과/재응시 로직

```
채점 결과 분기:
  ├─ 70점 이상 + 시간 내 제출 → 통과
  │   └─ 다음 챕터 학습 목록 리셋 (새 챕터 진입)
  │
  ├─ 70점 미만 → 불합격
  │   └─ 다른 버전의 챕터별 테스트가 리스트에 표시
  │       └─ 재응시 (동일 플로우: 인쇄 → 1시간 → OMR)
  │
  └─ 시간 내 미제출 → 자동 만료
      └─ 다른 버전의 챕터별 테스트가 리스트에 표시
          └─ 재응시 (동일 플로우)
```

- **챕터별 테스트는 여러 버전을 DB에 보관** (version 필드)
- 불합격/만료 시 이전에 풀지 않은 버전이 자동 배정
- **시간 내 제출 + 70점 이상**이 될 때까지 재응시 반복

### 4.4 기존 테스트 시스템과의 관계
- 챕터별 테스트는 프로 모드 전용 → **테스트 창고(`/tests`)에 표시하지 않음**
- 테스트 창고: 관리자가 업로드한 챕터별 테스트 **외의** 테스트만 표시
- 진단 테스트: 회원 가입 직후 응시 (레벨 결정용)

---

## 5. 테스트 결과 분석 (테스트 기록실)

### 5.1 접근 경로
- **스타트 페이지** → 테스트 기록실 (`/tests/history`)
- 학생 본인 + 학부모 확인 가능

### 5.2 성적표 포함 항목

| # | 분석 항목 | 설명 | 구현 상태 |
|---|-----------|------|-----------|
| 1 | **총점** | 전체 점수 | 기존 구현 완료 |
| 2 | **영역별 점수** | 문법/개념/문학/비문학 등 | 기존 구현 완료 |
| 3 | **점수 추이** | 시간에 따른 점수 변화 그래프 | **신규 필요** |
| 4 | **전체 등수 / 백분위** | 총 응시자 중 등수, 백분위 (1등=0.01%~꼴등=100%) | **신규 필요** |
| 5 | **기관 내 등수 / 백분위** | 소속 기관 응시자 중 등수, 백분위 | **신규 필요** |
| 6 | **풀이 속도 분석** | 찍은 문제 비율 기반 (판단 알고리즘 별도 협의 필요) | **신규 필요** |
| 7 | **강점/약점 유형 분석** | 영역·유형별 정답률 기반 강점·약점 도출 | **신규 필요** |
| 8 | **강점/약점 패턴 분석** | 오답 패턴 분석 | **신규 필요** |
| 9 | **추천 학습** | 약점 보강을 위한 농장별 모드 학습 추천 | **신규 필요** |
| 10 | **10대 역량** | *(별도 문서 제공 예정)* | **신규 필요** |
| 11 | **틀린 문제 개별 조언** | 문항별 맞춤 피드백 | **신규 필요** |
| 12 | **유사 문제 재학습** | 틀린 문제와 유사한 문제 연결 | **신규 필요** |
| 13 | **출력용 편집 인쇄** | 성적표를 편집하여 인쇄 가능 | **신규 필요** |

### 5.3 백분위 산출 방식
- **전체 백분위**: (등수 / 총 응시자 수) x 100
  - 1등 → 0.01% (최소값 고정), 꼴등 → 100%
- **기관 내 백분위**: 동일 기관 응시자만 대상으로 동일 산출

### 5.4 찍은 문제 판단 알고리즘
- **별도 협의 필요**
- 후보 접근법: 풀이 시간 기반, 답변 패턴 기반, 정답률 대비 이상치 등

---

## 6. StartPage 수정 사항

### 6.1 테스트 창고 문구 변경
- **현재**: "진단/챕터 시험"
- **변경**: "각종 시험 모음"
- 이유: 진단 테스트는 가입 직후 응시, 챕터별 테스트는 프로 모드에서 응시 → 테스트 창고는 그 외의 테스트만 표시

### 6.2 테스트 창고 필터링
- 챕터별 테스트(`series: "chapter"` 등)는 테스트 창고 목록에서 **제외**
- 관리자가 별도 업로드한 테스트만 표시

---

## 7. 데이터 모델 (신규 필요)

### 7.1 프로 모드 콘텐츠 구조
```
ProChapter (챕터)
  ├─ id, levelId, bookNumber(1~5), chapterNumber(1~4)
  ├─ globalChapterNumber(1~20)
  ├─ title, description
  └─ items: ProChapterItem[]

ProChapterItem (학습 아이템)
  ├─ id, chapterId, type (reading/vocab/background/logic/answer/test)
  ├─ contentId (learningCatalog 연결 또는 별도 콘텐츠)
  └─ order
```

### 7.2 프로 모드 진행 추적
```
ProProgress (학습 진행)
  ├─ userId, chapterId, itemId
  ├─ completed (boolean), completedAt
  └─ score, seedReward
```

### 7.3 챕터별 테스트 세션
```
ProTestSession
  ├─ userId, testId, chapterId
  ├─ printedAt (인쇄 시각)
  ├─ omrDeadline (printedAt + 1시간)
  ├─ status (printed/submitted/expired/passed/failed)
  └─ score
```

### 7.4 챕터별 테스트 버전 관리
```
ProChapterTest (챕터별 테스트 — 다중 버전)
  ├─ id, chapterId, version (1, 2, 3, ...)
  ├─ testPaperId (기존 TestPaper 연결)
  └─ status (active/archived)
```

---

## 8. 미정 / 추후 협의 항목

| # | 항목 | 상태 |
|---|------|------|
| 1 | 소쉬르 레벨 챕터 섹션 구성 | 미정 |
| 2 | 프레게 레벨 챕터 섹션 구성 | 미정 |
| 3 | 비트겐슈타인 레벨 챕터 섹션 구성 | 미정 |
| 4 | 찍은 문제 판단 알고리즘 | **별도 협의 필요** |
| 5 | 10대 역량 정의 | **별도 문서 제공 예정** |
| 6 | 챕터별 콘텐츠 JSON 데이터 | 각 챕터에 어떤 학습이 매핑되는지 데이터 필요 |
| 7 | 씨앗/비료 보상 정책 | 학습별 보상 종류·수량 결정 필요 |

---

## 9. 기존 재활용 가능 자원

| 자원 | 용도 | 재활용 방식 |
|------|------|-------------|
| `EngineShell` + 학습 모듈들 | 독해/어휘/배경지식/논리 학습 | `?proChapterId` 파라미터 전달 |
| `TestOmrPage` | OMR 답안 입력 | 기존 그대로 활용 |
| `TestReportPage` | 성적표 기본 틀 | 확장하여 추가 분석 항목 포함 |
| `TestWrongNotePage` | 오답 노트 기본 틀 | 개별 조언 + 유사 문제 연결 추가 |
| `LEARNING_CATALOG` | 학습 콘텐츠 매핑 | 프로 모드 챕터별 콘텐츠 연결에 활용 |
| 과제 자동 제출 패턴 | 학습 완료 추적 | 프로 모드 진행 추적에 동일 패턴 적용 |
