.engine-shell {
  --engine-orange: #ff8f2b;
  --engine-green: #6da475;
  --engine-ink: #2b221d;
  --engine-bg: #fffaf4;
  --sheet-width: 794px;
  --sheet-height: 1123px;
  --scale: min(1, calc((100vw - 24px) / var(--sheet-width)));
  min-height: 100vh;
  padding: calc(24px + var(--header-height, 0px)) 12px 40px;
  color: var(--engine-ink);
  font-family: var(--font-body);
  display: grid;
  gap: 18px;
  background: radial-gradient(circle at top, #fff5ea 0%, #f7ecdf 60%, #f1e4d3 100%);
  overflow-x: hidden;
}

.engine-viewport {
  width: 100%;
  display: flex;
  justify-content: center;
}

.engine-stage {
  width: calc(var(--sheet-width) * var(--scale));
}

.engine-scale {
  width: var(--sheet-width);
}

.engine-stage-inner {
  display: grid;
  gap: 18px;
}

@supports (zoom: 1) {
  .engine-scale {
    zoom: var(--scale);
  }
}

@supports not (zoom: 1) {
  .engine-scale {
    transform: scale(var(--scale));
    transform-origin: top center;
  }
}
.engine-header {
  background: #fff;
  border-radius: 14px;
  padding: 20px 32px;
  border: 1px solid rgba(255, 143, 43, 0.2);
  box-shadow: 0 14px 24px rgba(255, 143, 43, 0.15);
  display: grid;
  gap: 12px;
}

.engine-header-wrap {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  z-index: 80;
  display: flex;
  justify-content: center;
  width: 100%;
  pointer-events: none;
  padding: 12px 0;
}

.engine-header-wrap .engine-header {
  pointer-events: auto;
}

.engine-logo {
  display: inline-flex;
  align-items: center;
}

.engine-logo img {
  width: 56px;
  height: auto;
  display: block;
}

.engine-header-row {
  display: flex;
  align-items: center;
  gap: 12px;
  width: 100%;
}

.engine-header-row.secondary .engine-timebar {
  flex: 1;
  max-width: 80%;
}

.engine-header-row.secondary .engine-timebar .timebar {
  width: 100%;
}

.engine-header h1 {
  margin: 6px 0 4px;
  font-family: var(--font-display);
  font-size: 24px;
}

.engine-header-item {
  display: flex;
  align-items: center;
  gap: 6px;
  font-size: 24px;
  color: #3d2f28;
  white-space: nowrap;
}

.engine-header-item.engine-title {
  min-width: 140px;
}

.engine-badge {
  display: inline-flex;
  padding: 4px 10px;
  border-radius: 999px;
  background: rgba(255, 143, 43, 0.2);
  font-size: 11px;
  font-weight: 700;
}

.engine-header-label {
  font-size: 11px;
  color: #8a7468;
}

.engine-body {
  width: var(--sheet-width);
  height: var(--sheet-height);
  border-radius: 18px;
  padding: 24px;
  border: 1px solid rgba(109, 164, 117, 0.2);
  position: relative;
  overflow: hidden;
  background-color: var(--engine-bg);
  background-image: var(--sheet-bg);
  background-size: cover;
  background-position: center;
  background-repeat: no-repeat;
}

.engine-body.stack {
  height: auto;
  min-height: var(--sheet-height);
  padding: 0;
  border: none;
  background-image: none;
  overflow: visible;
}

.engine-header-divider {
  width: 1px;
  height: 36px;
  background: rgba(61, 47, 40, 0.15);
}

.engine-footer {
  display: flex;
  align-items: center;
  justify-content: flex-start;
  gap: 16px;
}

.engine-exit {
  border: none;
  background: var(--engine-orange);
  color: #fff;
  border-radius: 14px;
  padding: 24px 40px;
  font-weight: 700;
  font-size: 28px;
  cursor: pointer;
}

.engine-error {
  background: #fff;
  padding: 20px;
  border-radius: 16px;
  border: 1px solid rgba(255, 143, 43, 0.3);
}

.timebar {
  width: 260px;
}

.timebar-track {
  width: 100%;
  height: 20px;
  background: #f1e3d5;
  border-radius: 999px;
  overflow: hidden;
}

.timebar-fill {
  height: 100%;
  background: linear-gradient(90deg, #6da475, #ff8f2b);
  transition: width 420ms cubic-bezier(0.22, 1.2, 0.36, 1), filter 420ms ease;
}

.timebar.gain .timebar-fill {
  filter: brightness(1.35) saturate(1.2);
  animation: timebar-pop 480ms ease-out;
}

.timebar.loss .timebar-fill {
  filter: brightness(0.85) saturate(0.8);
  animation: timebar-shake 420ms ease-out;
}

@keyframes timebar-pop {
  0% {
    transform: scaleY(1);
  }
  35% {
    transform: scaleY(1.35);
  }
  100% {
    transform: scaleY(1);
  }
}

@keyframes timebar-shake {
  0% {
    transform: translateX(0);
  }
  25% {
    transform: translateX(-6px);
  }
  50% {
    transform: translateX(6px);
  }
  75% {
    transform: translateX(-4px);
  }
  100% {
    transform: translateX(0);
  }
}

.engine-progress-track {
  width: 100%;
  height: 16px;
  background: rgba(109, 164, 117, 0.2);
  border-radius: 999px;
  overflow: hidden;
}

.engine-progress-fill {
  height: 100%;
  background: linear-gradient(90deg, rgba(109, 164, 117, 0.7), rgba(255, 143, 43, 0.9));
}

.engine-footer-item {
  display: flex;
  align-items: center;
  gap: 10px;
  font-size: 24px;
  color: #6b5b53;
  min-width: 420px;
}

.engine-footer-label {
  font-size: 22px;
  color: #8a7468;
  white-space: nowrap;
}

.seed-row {
  display: flex;
  align-items: center;
  gap: 4px;
}

.seed-icon {
  width: 28px;
  height: 20px;
  display: inline-block;
  background-image: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 40 28'><defs><linearGradient id='g' x1='0' y1='0' x2='1' y2='1'><stop offset='0' stop-color='%23ffd27f'/><stop offset='1' stop-color='%23ff9f2b'/></linearGradient></defs><ellipse cx='20' cy='14' rx='18' ry='10' fill='url(%23g)' stroke='%23c9751a' stroke-width='2'/></svg>");
  background-size: contain;
  background-repeat: no-repeat;
}

.question-modal-overlay {
  position: absolute;
  inset: 0;
  pointer-events: none;
  background: transparent;
  z-index: 20;
}

.question-modal {
  position: absolute;
  top: 0;
  left: 0;
  background: rgba(255, 255, 255, 0.6);
  border-radius: 14px;
  padding: 14px;
  width: 320px;
  display: grid;
  gap: 12px;
  border: 1px solid rgba(0, 0, 0, 0.15);
  box-shadow: 0 10px 24px rgba(0, 0, 0, 0.15);
  pointer-events: auto;
  backdrop-filter: blur(4px);
}

.question-modal-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  cursor: move;
  user-select: none;
  touch-action: none;
}

.question-close {
  border: none;
  background: transparent;
  color: #6b5b53;
  cursor: pointer;
}

.question-modal-prompt {
  margin: 0;
  color: #4b3d36;
  font-size: 13px;
}

.question-modal-choices {
  display: grid;
  gap: 10px;
}

.question-choice {
  border: 1px solid rgba(0, 0, 0, 0.12);
  background: #ffffff;
  border-radius: 12px;
  padding: 8px 12px;
  text-align: left;
  display: flex;
  align-items: center;
  gap: 10px;
  cursor: pointer;
  font-size: 13px;
}

.choice-label {
  background: rgba(255, 143, 43, 0.2);
  color: #a6530b;
  font-weight: 700;
  padding: 2px 8px;
  border-radius: 999px;
  font-size: 11px;
}

.worksheet-start {
  display: grid;
  gap: 16px;
  align-content: center;
  justify-items: center;
  height: 100%;
}

.worksheet-start-btn {
  border: none;
  background: var(--engine-orange);
  color: #fff;
  padding: 12px 20px;
  border-radius: 14px;
  font-weight: 700;
  cursor: pointer;
}

.worksheet-empty {
  border: 1px dashed rgba(0, 0, 0, 0.15);
  border-radius: 16px;
  padding: 30px;
  text-align: center;
  color: #6b5b53;
}

.worksheet-module {
  position: relative;
  height: 100%;
}

.worksheet-sheet {
  display: flex;
  align-items: flex-start;
  justify-content: space-between;
  gap: 16px;
}

.worksheet-stem-row {
  display: flex;
  align-items: center;
  gap: 12px;
}

.worksheet-list {
  list-style: none;
  padding: 0;
  margin: 0;
  display: grid;
  gap: 14px;
}

.worksheet-dict-grid {
  display: grid;
  gap: 12px;
  margin-bottom: 18px;
}

.worksheet-dict-card {
  border: 2px solid rgba(75, 61, 54, 0.4);
  border-radius: 10px;
  padding: 10px 12px;
  background: transparent;
}

.dict-headword {
  display: flex;
  align-items: baseline;
  gap: 8px;
  font-size: 18px;
  color: #3d2f28;
}

.dict-pos {
  font-size: 14px;
  color: rgba(75, 61, 54, 0.8);
}

.dict-sense {
  margin-top: 6px;
  font-size: 15px;
  color: #4b3d36;
}

.dict-example {
  margin-top: 6px;
  font-size: 14px;
  color: rgba(75, 61, 54, 0.8);
}

.worksheet-item {
  display: grid;
  grid-template-columns: 48px 1fr auto;
  align-items: start;
  gap: 10px;
  padding: 6px 8px;
  border-radius: 10px;
  position: relative;
}

.worksheet-item-number {
  font-weight: 800;
  color: #5a4b44;
  display: inline-flex;
  align-items: center;
  gap: 6px;
  position: relative;
}

.worksheet-item-text {
  line-height: 1.5;
}

.worksheet-item.active .worksheet-item-text {
  background: linear-gradient(
    180deg,
    transparent 35%,
    rgba(255, 233, 140, 0.7) 35%,
    rgba(255, 233, 140, 0.7) 85%,
    transparent 85%
  );
  border-radius: 6px;
  padding: 0 4px;
  box-shadow: 0 0 10px rgba(255, 214, 102, 0.45);
  box-decoration-break: clone;
  -webkit-box-decoration-break: clone;
}

.worksheet-item.dict.active .worksheet-item-text {
  background: none;
  box-shadow: none;
  padding: 0;
}

.worksheet-pages {
  display: grid;
  gap: 18px;
}

.worksheet-page {
  width: var(--sheet-width);
  height: var(--sheet-height);
  background-color: var(--engine-bg);
  background-image: var(--sheet-bg);
  background-size: cover;
  background-position: center;
  background-repeat: no-repeat;
  border-radius: 18px;
  border: 1px solid rgba(109, 164, 117, 0.2);
  box-shadow: 0 12px 24px rgba(0, 0, 0, 0.12);
}

.worksheet-page.single {
  height: auto;
  min-height: var(--sheet-height);
}

.worksheet-page-inner {
  height: 100%;
  padding: 24px;
  box-sizing: border-box;
  position: relative;
}

.worksheet-page-number {
  position: absolute;
  top: 12px;
  right: 18px;
  font-size: 14px;
  color: rgba(75, 61, 54, 0.6);
  font-weight: 600;
}

.worksheet-columns {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 24px;
  height: 100%;
}

.worksheet-measure {
  position: absolute;
  visibility: hidden;
  pointer-events: none;
  width: calc((var(--sheet-width) - 48px - 24px) / 2);
  top: 0;
  left: 0;
}

.worksheet-mark {
  font-size: 22px;
  font-weight: 700;
  color: #2f7a46;
}

.worksheet-mark.wrong {
  color: #c0392b;
}

.worksheet-number-mark {
  position: absolute;
  left: -6px;
  top: -8px;
  width: 34px;
  height: 28px;
  background-size: contain;
  background-repeat: no-repeat;
  opacity: 0.65;
  color: transparent;
  font-size: 0;
  pointer-events: none;
}

.worksheet-number-mark.wrong {
  background-image: url("/%EC%98%A4%EB%8B%B5%20%EA%BA%BE%EC%9D%80%EC%84%A0.png");
}

.worksheet-number-mark.correct {
  background-image: url("/%EC%A0%95%EB%8B%B5%20%EB%8F%99%EA%B7%B8%EB%9D%BC%EB%AF%B8.png");
}

.worksheet-template {
  font-weight: 700;
  margin-top: 10px;
  color: #3f322b;
}

.worksheet-highlight {
  background: linear-gradient(
    180deg,
    transparent 35%,
    rgba(255, 233, 140, 0.7) 35%,
    rgba(255, 233, 140, 0.7) 85%,
    transparent 85%
  );
  border-radius: 4px;
  padding: 0 2px;
  box-shadow: 0 0 10px rgba(255, 214, 102, 0.45);
  box-decoration-break: clone;
  -webkit-box-decoration-break: clone;
}

.worksheet-blank {
  display: inline-block;
  padding: 0 6px;
  border-bottom: 2px solid rgba(61, 47, 40, 0.5);
  margin: 0 2px;
  min-width: 32px;
  text-align: center;
}

.worksheet-blank.active {
  background: rgba(255, 233, 140, 0.6);
  box-shadow: 0 0 8px rgba(255, 214, 102, 0.45);
  border-bottom-color: rgba(255, 143, 43, 0.9);
}

.worksheet-controls {
  display: grid;
  gap: 10px;
  justify-items: end;
  font-size: 12px;
  color: #6b5b53;
}

.worksheet-status {
  display: flex;
  gap: 6px;
  margin-top: 10px;
}

.status-dot {
  font-size: 14px;
  color: #b0a59a;
}

.status-dot.correct {
  color: #2f7a46;
}

.status-dot.wrong {
  color: #c0392b;
}

.manuscript-grid {
  margin-top: 10px;
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(18px, 1fr));
  gap: 6px;
  max-width: 320px;
}

.manuscript-cell {
  width: 18px;
  height: 18px;
  border: 1px solid rgba(0, 0, 0, 0.2);
  border-radius: 4px;
  display: grid;
  place-items: center;
  font-size: 10px;
  color: #2f7a46;
}
.worksheet-feedback {
  margin-top: 12px;
  font-weight: 700;
  color: #2f7a46;
}

.worksheet-feedback.correct {
  color: #2f7a46;
}

.worksheet-feedback.wrong {
  color: #c0392b;
}

.worksheet-pdf-btn {
  border: 1px solid rgba(0, 0, 0, 0.12);
  background: #fff;
  border-radius: 999px;
  padding: 6px 12px;
  cursor: pointer;
}

.worksheet-pdf-overlay {
  position: absolute;
  inset: 0;
  background: rgba(0, 0, 0, 0.5);
  display: grid;
  place-items: center;
  z-index: 20;
}

.worksheet-pdf-card {
  width: min(720px, 95vw);
  background: #fff;
  border-radius: 16px;
  padding: 16px;
  display: grid;
  gap: 12px;
}

.pdf-viewer {
  width: 100%;
  height: 520px;
}

.reading-passage {
  background: #fff;
  border-radius: 18px;
  padding: 18px;
  max-height: 360px;
  overflow-y: auto;
  border: 1px solid rgba(0, 0, 0, 0.08);
}

.reading-passage mark.highlight {
  background: linear-gradient(
    180deg,
    transparent 35%,
    rgba(255, 233, 140, 0.7) 35%,
    rgba(255, 233, 140, 0.7) 85%,
    transparent 85%
  );
  padding: 0 2px;
  border-radius: 4px;
  color: inherit;
  box-decoration-break: clone;
  -webkit-box-decoration-break: clone;
  box-shadow: 0 0 10px rgba(255, 214, 102, 0.45);
  filter: saturate(1.15);
}

.reading-meta {
  margin-top: 12px;
  display: flex;
  justify-content: space-between;
  font-size: 12px;
  color: #6b5b53;
}

.reading-feedback {
  font-weight: 700;
}

.recall-dropzone {
  background: #fff;
  border-radius: 18px;
  border: 2px dashed rgba(0, 0, 0, 0.1);
  padding: 18px;
  text-align: center;
  font-weight: 700;
  margin-bottom: 16px;
}

.recall-cards {
  display: grid;
  gap: 12px;
}

.recall-card {
  background: #fff;
  border-radius: 16px;
  padding: 14px;
  display: grid;
  gap: 10px;
  border: 1px solid rgba(0, 0, 0, 0.08);
}

.recall-index {
  font-weight: 700;
  color: #ff8f2b;
}

.recall-actions {
  display: flex;
  gap: 10px;
}

.recall-actions button {
  border: none;
  background: #f2f2f2;
  padding: 6px 10px;
  border-radius: 10px;
  cursor: pointer;
}

.recall-footer {
  display: flex;
  justify-content: space-between;
  margin-top: 14px;
}

.recall-footer button {
  border: none;
  background: var(--engine-orange);
  color: #fff;
  padding: 8px 14px;
  border-radius: 10px;
  cursor: pointer;
}

.recall-feedback {
  margin-top: 8px;
  color: #a6530b;
}

.recall-answer {
  margin-top: 16px;
  background: #fff;
  border-radius: 14px;
  padding: 12px;
  border: 1px dashed rgba(0, 0, 0, 0.15);
}

.token-passage {
  display: grid;
  gap: 8px;
}

.token-chip {
  border: none;
  background: transparent;
  padding: 2px 4px;
  cursor: pointer;
  border-radius: 6px;
}

.token-chip.highlight {
  background: linear-gradient(
    180deg,
    transparent 35%,
    rgba(255, 233, 140, 0.68) 35%,
    rgba(255, 233, 140, 0.68) 85%,
    transparent 85%
  );
  border-radius: 6px;
  box-shadow: 0 0 10px rgba(255, 214, 102, 0.45);
  filter: saturate(1.1);
}

.token-chip.active {
  background: rgba(109, 164, 117, 0.35);
}

.choice-module .choice-body {
  display: grid;
  grid-template-columns: 1fr 1.2fr;
  gap: 16px;
}

.choice-list {
  display: grid;
  gap: 10px;
}

.choice-item {
  border: 1px solid rgba(0, 0, 0, 0.12);
  background: #fff;
  border-radius: 12px;
  padding: 10px;
  display: flex;
  align-items: center;
  gap: 10px;
  cursor: pointer;
}

.choice-item.active {
  border-color: var(--engine-orange);
  box-shadow: 0 10px 20px rgba(255, 143, 43, 0.2);
}

.choice-mark {
  margin-left: auto;
  font-weight: 700;
  color: #d85a16;
}

.choice-props {
  margin-top: 14px;
  display: grid;
  gap: 8px;
  font-size: 13px;
}

.choice-prop {
  display: flex;
  justify-content: space-between;
  padding: 6px 10px;
  background: rgba(255, 143, 43, 0.08);
  border-radius: 8px;
}

.choice-prop-mark {
  font-weight: 700;
  color: #ff8f2b;
}

.phoneme-cells {
  display: flex;
  gap: 10px;
  margin-top: 16px;
}

.phoneme-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  font-size: 13px;
  color: #6b5b53;
}

.phoneme-cell {
  min-width: 80px;
  padding: 12px;
  border-radius: 12px;
  background: #fff;
  border: 1px solid rgba(0, 0, 0, 0.08);
  text-align: center;
  font-weight: 700;
}

.phoneme-cell.env {
  border-color: #6da475;
  background: rgba(109, 164, 117, 0.15);
}

.phoneme-cell.target {
  border-color: #4d8bcc;
  background: rgba(77, 139, 204, 0.18);
}

.morpheme-strip {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  margin-top: 12px;
}

.morpheme-chip {
  background: #fff;
  border-radius: 12px;
  padding: 6px 10px;
  border: 1px solid rgba(0, 0, 0, 0.12);
}

.morpheme-chip.active {
  background: rgba(255, 143, 43, 0.2);
  border-color: var(--engine-orange);
}

.sentence-structure-module .sentence-tokens {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  margin-top: 12px;
}

.token-chip.role-1 {
  border: 1px solid rgba(255, 143, 43, 0.5);
}

.token-chip.role-2 {
  border: 1px solid rgba(77, 139, 204, 0.5);
}

.token-chip.role-3 {
  border: 1px solid rgba(109, 164, 117, 0.5);
}

.token-chip.highlight {
  background: linear-gradient(
    180deg,
    transparent 35%,
    rgba(255, 233, 140, 0.68) 35%,
    rgba(255, 233, 140, 0.68) 85%,
    transparent 85%
  );
  border-radius: 6px;
  box-shadow: 0 0 10px rgba(255, 214, 102, 0.45);
  filter: saturate(1.1);
}

.confirm-next {
  margin-top: 12px;
  text-align: right;
}

.confirm-next button {
  border: none;
  background: var(--engine-orange);
  color: #fff;
  padding: 8px 14px;
  border-radius: 10px;
  cursor: pointer;
}

.confirm-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  font-size: 13px;
  color: #6b5b53;
}

.sentence-actions button {
  border: none;
  background: var(--engine-orange);
  color: #fff;
  padding: 8px 14px;
  border-radius: 10px;
  cursor: pointer;
}

.result-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  display: grid;
  place-items: center;
  z-index: 50;
}

.result-card {
  background: #fff;
  border-radius: 18px;
  padding: 20px;
  width: min(520px, 90vw);
  display: grid;
  gap: 16px;
}

.result-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
  gap: 12px;
}

.result-grid span {
  color: #6b5b53;
  font-size: 12px;
}

.result-grid strong {
  font-size: 18px;
}

.result-actions button {
  border: none;
  background: var(--engine-orange);
  color: #fff;
  padding: 10px 16px;
  border-radius: 12px;
  cursor: pointer;
}
